<!-- templates/home/index.html -->
{% extends "base.html" %}
{% load static %}

{% block title %}Home - {{ block.super }}{% endblock %}

{% block content %}
<!-- Hero Section -->
<section class="hero-section bg-primary text-white py-5">
    <div class="container">
        <div class="row align-items-center">
            <div class="col-lg-4">
                <img src="{% static 'badge.jpeg' %}" alt="School Badge" class="img-fluid rounded" style="height: 360px; width: 100%; object-fit: contain; padding-left: -70px;">
            </div>
            <div class="col-lg-8">
                <h1 class="display-4 fw-bold" style="font-size: 80px;">Kinkiizi High School</h1>
                <p class="lead" style="font-size: 40px;">Excellence in Education Since 1967</p>
                <a href="{% url 'about' %}" class="btn btn-light btn-lg mt-3">Learn More About Us</a>
            </div>
        </div>
    </div>
</section>

<!-- Photo Lightbox Section -->
<section class="py-4">
    <div class="container">
        <div class="bg-light p-3 p-md-4 rounded shadow-sm">
            
            <div id="thumbnailCarousel" class="carousel slide" data-bs-ride="carousel" data-bs-interval="2500">
                <div class="carousel-inner text-center">
                    {% for image in gallery_images %}
                    <div class="carousel-item {% if forloop.first %}active{% endif %}">
                    <a href="{{ image.image.url }}" data-bs-toggle="modal" data-bs-target="#lightboxModal" data-index="{{ forloop.counter0 }}">
                            <img src="{{ image.image.url }}" alt="{{ image.title }}" class="img-fluid rounded" style="height: 180px; width: auto; max-width: 100%; object-fit: cover;">
                        </a>
                    </div>
                    {% empty %}
                    <div class="carousel-item active">
                        <div class="p-3">No photos yet.</div>
                    </div>
                    {% endfor %}
                </div>
                <button class="carousel-control-prev" type="button" data-bs-target="#thumbnailCarousel" data-bs-slide="prev">
                    <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                    <span class="visually-hidden">Previous</span>
                </button>
                <button class="carousel-control-next" type="button" data-bs-target="#thumbnailCarousel" data-bs-slide="next">
                    <span class="carousel-control-next-icon" aria-hidden="true"></span>
                    <span class="visually-hidden">Next</span>
                </button>
            </div>
        </div>
    </div>
</section>

<!-- Lightbox Modal with Carousel -->
<div class="modal fade" id="lightboxModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-xl">
        <div class="modal-content bg-dark">
            <div class="modal-body p-0">
                <div id="lightboxCarousel" class="carousel slide" data-bs-ride="carousel" data-bs-interval="3000">
                    <div class="carousel-inner">
                        {% for image in gallery_images %}
                        <div class="carousel-item {% if forloop.first %}active{% endif %}">
                            <img src="{{ image.image.url }}" class="d-block" alt="{{ image.title }}" style="max-height: 90vh; width: 100%; object-fit: contain; background: #000;">
                        </div>
                        {% endfor %}
                    </div>
                    <button class="carousel-control-prev" type="button" data-bs-target="#lightboxCarousel" data-bs-slide="prev">
                        <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                        <span class="visually-hidden">Previous</span>
                    </button>
                    <button class="carousel-control-next" type="button" data-bs-target="#lightboxCarousel" data-bs-slide="next">
                        <span class="carousel-control-next-icon" aria-hidden="true"></span>
                        <span class="visually-hidden">Next</span>
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Welcome Message -->
<section class="py-5">
    <div class="container">
        <div class="row">
            <div class="col-lg-12">
                {% if home_content %}
                <div class="text-center mb-5">
                    <h2 class="mb-4">{{ home_content.welcome_title }}</h2>
                    <p class="lead">{{ home_content.welcome_message|linebreaks }}</p>
                </div>
                {% else %}
                <h2 class="text-center mb-5">Welcome Message</h2>
                <p class="lead text-center">Welcome to our school community where we nurture young minds and prepare them for a bright future.</p>
                {% endif %}
            </div>
        </div>
    </div>
</section>

<!-- Principal Message -->
{% if home_content and home_content.principal_message %}
<section class="py-5">
    <div class="container">
        <div class="row">
            <div class="col-lg-10 mx-auto">
                <h2 class="text-center mb-4">Head Teacher's Message</h2>
                <div class="card shadow-sm border-0">
                    <div class="card-body p-4">
                        <p class="lead mb-0">{{ home_content.principal_message|linebreaks }}</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>
{% endif %}

<!-- Latest News -->
<section class="bg-light py-5">
    <div class="container">
        <h2 class="text-center mb-5">Latest News & Events</h2>
        <div class="row">
            {% for news in latest_news %}
            <div class="col-md-4 mb-4">
                <div class="card h-100">
                    {% if news.image %}
                    <img src="{{ news.image.url }}" class="card-img-top" alt="{{ news.title }}" style="height: 200px; object-fit: cover;">
                    {% endif %}
                    <div class="card-body">
                        <h5 class="card-title">{{ news.title }}</h5>
                        <p class="card-text">{{ news.content|truncatewords:20 }}</p>
                        <small class="text-muted">{{ news.created_at|date:"M d, Y" }}</small>
                    </div>
                    <div class="card-footer">
                        <a href="{% url 'news_detail' news.id %}" class="btn btn-primary btn-sm">Read More</a>
                    </div>
                </div>
            </div>
            {% empty %}
            <div class="col-12">
                <p class="text-center">No news available at the moment.</p>
            </div>
            {% endfor %}
        </div>
        <div class="text-center mt-4">
            <a href="{% url 'news_list' %}" class="btn btn-outline-primary">View All News</a>
        </div>
    </div>
</section>

<!-- Gallery section intentionally removed from homepage -->

<!-- Quick Info -->
<section class="bg-dark text-white py-5">
    <div class="container">
        <div class="row text-center">
            <div class="col-md-3">
                <h3>1000+</h3>
                <p>Students</p>
            </div>
            <div class="col-md-3">
                <h3>50+</h3>
                <p>Qualified Teachers</p>
            </div>
            <div class="col-md-3">
                <h3>55+</h3>
                <p>Years Experience</p>
            </div>
            <div class="col-md-3">
                <h3>100%</h3>
                <p>Success Rate</p>
            </div>
        </div>
    </div>
</section>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('click', function (event) {
    var link = event.target.closest('a[data-bs-target="#lightboxModal"][data-index]');
    if (!link) return;
    var index = parseInt(link.getAttribute('data-index'), 10) || 0;
    var carouselEl = document.getElementById('lightboxCarousel');
    if (!carouselEl) return;
    var carousel = bootstrap.Carousel.getOrCreateInstance(carouselEl, { interval: 3000, ride: 'carousel' });
    carousel.to(index);
});

// Start cycling when modal opens; pause when it closes
var modalEl = document.getElementById('lightboxModal');
if (modalEl) {
    modalEl.addEventListener('shown.bs.modal', function () {
        var carouselEl = document.getElementById('lightboxCarousel');
        if (!carouselEl) return;
        var carousel = bootstrap.Carousel.getOrCreateInstance(carouselEl, { interval: 3000, ride: 'carousel' });
        carousel.cycle();
    });
    modalEl.addEventListener('hidden.bs.modal', function () {
        var carouselEl = document.getElementById('lightboxCarousel');
        if (!carouselEl) return;
        var carousel = bootstrap.Carousel.getOrCreateInstance(carouselEl);
        carousel.pause();
    });
}
</script>
{% endblock %}